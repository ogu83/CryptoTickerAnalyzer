python .\train_next_close_multivenue_plus.py --symbol ETH-USDT --period 100 --target delta_norm --epochs 60 --window 64 --save-dir models --model-name okx_ETH-USDT_100_dnorm_w64 --plot

python .\signal_backtest.py --model-dir models/okx_ETH-USDT_10_dnorm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --period 10 --start 2025-08-28T00:00:00Z --end 2025-08-30T00:00:00Z --threshold 0.15 --init-usdt 10000 --fee-bps 2 --slip-bps 1 --plot
python .\signal_backtest.py --model-dir models\okx_ETH-USDT_10_dnorm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --period 10 --start 2025-08-28T00:00:00Z --end 2025-08-30T00:00:00Z --auto-threshold --quantile 0.85 --long-only --init-usdt 10000 --fee-bps 2 --slip-bps 1 --plot
python .\signal_backtest.py --model-dir models\okx_ETH-USDT_10_dnorm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --period 10 --start 2025-08-28T00:00:00Z --end 2025-09-05T00:00:00Z --signal-mode open_ret --auto-threshold --quantile 0.95 --min-edge-bps 5 --long-only --position-frac 0.2 --hold 1 --fee-bps 2 --slip-bps 1 --plot
python .\signal_backtest.py --model-dir models\okx_ETH-USDT_10_dnorm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --period 10 --start 2025-08-28T00:00:00Z --end 2025-09-05T00:00:00Z --signal-mode open_ret --auto-threshold --quantile 0.97 --min-edge-bps 0 --hold 2 --position-frac 0.1 --fee-bps 2 --slip-bps 1 --plot

python train_orderbook.py --symbol ETH-USDT --window 64 --epochs 40 --target mid_delta_norm --step 5 --plot
python train_ob_anomaly.py --symbol ETH-USDT --window 64 --epochs 40 --step 5 --plot

python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --quantile 0.995 --dir-alpha 0.5 --hold 2 --position-frac 0.1 --fee-bps 2 --slip-bps 1 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --usequantile --quantile 0.995 --consec 3 --cooldown 20 --dir-alpha 0.5 --tilt-ema 5 --hold 3 --position-frac 0.05 --fee-bps 2 --slip-bps 1 --spread-cap-bps 2.0 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --usequantile --quantile 0.75 --consec 3 --cooldown 20 --dir-alpha 0.5 --tilt-ema 5 --hold 3 --position-frac 0.05 --fee-bps 0 --slip-bps 0 --spread-cap-bps 2.0 --min-edge-bps 0 --edge-buffer-bps 0 --max-trades-per-hour 10 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --usequantile --quantile 0.75 --consec 2 --cooldown 15 --dir-alpha 0.5 --tilt-ema 5 --hold 3 --position-frac 0.05 --fee-bps 2 --slip-bps 1 --spread-cap-bps 2.5 --min-edge-bps 0 --edge-buffer-bps 0.5 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 10 --usequantile --quantile 0.95 --consec 3 --cooldown 20 --dir-alpha 0.5 --tilt-ema 5 --hold 5 --position-frac 0.05 --fee-bps 2 --slip-bps 1 --spread-cap-bps 2.0 --min-edge-bps 4 --edge-buffer-bps 1 --max-trades-per-hour 12 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --roll-quantile 0.90 --roll-window 2H --consec 2 --cooldown 15 --dir-alpha 0.5 --tilt-ema 5 --hold 3 --position-frac 0.05 --fee-bps 2 --slip-bps 1 --spread-cap-bps 2.0 --auto-min-edge --k-spread 0.7 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --roll-quantile 0.80 --roll-window 2h --consec 2 --cooldown 15 --dir-alpha 0.5 --tilt-ema 5 --hold 3 --position-frac 0.05 --fee-bps 2 --slip-bps 1 --spread-cap-bps 2.0 --auto-min-edge --k-spread 0.2 --edge-scale 5.0 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --roll-quantile 0.90 --roll-window 2h --consec 3 --cooldown 15 --dir-alpha 0.5 --tilt-ema 5 --hold 1 --position-frac 0.05 --fee-bps 2 --slip-bps 1 --spread-cap-bps 1.2 --auto-min-edge --edge-buffer-bps 2 --k-spread 0.5 --edge-scale 5 --max-trades-per-hour 5 --plot
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --roll-quantile 0.90 --roll-window 2h --consec 3 --side-persist 2 --spread-cap-bps 1.2 --edge-scale 2.5 --auto-min-edge --k-spread 0.6 --edge-buffer-bps 1.5 --edge-margin-bps 0.5 --hold 1 --position-frac 0.05 --max-trades-per-hour 5 --plot


SANITY CHECK
--------------------
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --roll-quantile 0.90 --roll-window 2h --consec 2 --spread-cap-bps 1.5 --fee-bps 0 --slip-bps 0 --edge-buffer-bps 0 --auto-min-edge --k-spread 0 --edge-scale 1.0 --plot


Scale edges to realistic, cost-clearing levels
--------------------
python ob_anomaly_backtest.py --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 --api http://macbook-server:8200 --symbol ETH-USDT --step 5 --roll-quantile 0.90 --roll-window 2h --consec 2 --spread-cap-bps 1.5 --fee-bps 0 --slip-bps 0 --edge-buffer-bps 0 --auto-min-edge --k-spread 0 --edge-scale 8.0 --plot


A concrete “balanced” recipe
--------------------
python ob_anomaly_backtest.py `
  --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 `
  --reg-model-dir models_ob\okx_ob_ETH-USDT_step5_mid_delta_norm_w64 `
  --api http://macbook-server:8200 --symbol ETH-USDT --step 5 `
  --roll-quantile 0.85 --roll-window 90min `
  --consec 2 --spread-cap-bps 1.5 --side-persist 2 `
  --auto-min-edge --k-spread 0.3 `
  --edge-buffer-bps 0.5 `
  --auto-edge-scale 0.90 `
  --min-pass-rate 0.08 `
  --max-trades-per-hour 5 --hold 2 --position-frac 0.05 `
  --fee-bps 2 --slip-bps 1 `
  --plot

Bypass the edge gate
--------------------
  python ob_anomaly_backtest.py `
  --model-dir models_ob_anom\okx_ob_anom_ETH-USDT_step5_w64 `
  --api http://macbook-server:8200 --symbol ETH-USDT --step 5 `
  --roll-quantile 0.9 --roll-window 2h --consec 2 --spread-cap-bps 1.5 --plot

LightGBM Training
--------------------
# Example: LightGBM on OKX top-of-book, 5-s snapshot sampling
python train_orderbook.py --algo lgbm --symbol ETH-USDT --step 5 --target mid_delta_norm --plot

LightGBM BackTest 
--------------------
python ob_lgbm_backtest.py `
  --model-dir models_ob/okx_ob_ETH-USDT_step5_mid_delta_norm_lgbm `
  --api http://macbook-server:8200 --symbol ETH-USDT --step 5 `
  --timeout 600 `
  --auto-min-edge --k-spread 0.3 --spread-cap-bps 2.5 `
  --edge-scale 1.0 --hold 2 --position-frac 0.1 --fee-bps 2 --slip-bps 1 `
  --max-trades-per-hour 10 --plot

